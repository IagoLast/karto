{"version":3,"sources":["webpack:///webpack/bootstrap 7d4324aa8de3d08fc502","webpack:///./karto.js","webpack:///./classes/Layer.js","webpack:///./index.js","webpack:///./services/api.service.js","webpack:///./services/config.service.js","webpack:///./services/render.service.js"],"names":["INYECTED_DEPENDENCES","renderService","apiService","Karto","constructor","layers","loadConfig","config","initMap","center","zoom","addLayers","then","drawLayers","layersInfo","Promise","all","map","addLayer","bind","forEach","layer","show","layerConfig","$index","zIndex","apiUrl","init","push","Layer","_getTileUrl","create","url","view","hide","setZIndex","index","setSQL","sql","options","getLayerUrl","fetch","res","json","initApp","karto","window","HEADERS","Headers","method","headers","body","_buildBody","data","layergroupid","JSON","stringify","parse","_parseCenter","_getLayers","_generateUrl","maps_api_config","type","maps_api_template","replace","user_name","mapId","L","remove","addTo","tileLayer"],"mappings":"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","file":"app.bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 2);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 7d4324aa8de3d08fc502","import Layer from './classes/Layer.js';\nimport * as configService from './services/config.service.js';\nimport * as apiService from './services/api.service.js';\nimport renderService from './services/render.service.js';\n\n// Layer objects will have renderService and apiService injected.\n// This should be done using a proper DI method, but itÂ´s ok for the demo.\nconst INYECTED_DEPENDENCES = {\n  renderService,\n  apiService\n};\n\n/**\n * This is the library main file.\n * This allows to draw a map simply passing a configuraton file.\n * The map is just a list of Layers.\n */\nexport default class Karto {\n  constructor() {\n    this.layers = [];\n  }\n\n  /**\n   * Create a new map from a json config.\n   * Once the config is correctly parsed and transformed into a `MapConfig` the layers are stored and drawn.\n   */\n  loadConfig(config) {\n    this.config = configService.parse(config);\n    renderService.initMap({\n      center: this.config.center,\n      zoom: this.config.zoom,\n    });\n    this.addLayers(this.config.layers)\n      .then(this.drawLayers);\n  }\n\n  /**\n   * Add a layer list to the Karto map.\n   * The `layers` field is a `MapConfig.layers` object. https://carto.com/docs/carto-engine/maps-api/mapconfig\n   */\n  addLayers(layersInfo) {\n    return Promise.all(layersInfo.map(this.addLayer.bind(this)));\n  }\n\n  // Show a list of layers\n  drawLayers(layers) {\n    layers.forEach(layer => layer.show());\n  }\n\n  // Create a new Layer object and add it to the layer list.\n  addLayer(layerConfig, $index) {\n    layerConfig.zIndex = $index;\n    layerConfig.apiUrl = this.config.apiUrl;\n    return new Layer(layerConfig, INYECTED_DEPENDENCES)\n      .init()\n      .then(layer => {\n        this.layers.push(layer);\n        return layer;\n      });\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./karto.js","export default class Layer {\n  constructor(layerConfig, {renderService, apiService}) {\n    this.config = layerConfig;\n    this.renderService = renderService;\n    this.apiService = apiService;\n  }\n\n  init() {\n    return this._getTileUrl().then(this.create.bind(this));\n  }\n\n  create(url) {\n    this.view = this.renderService.create(url);\n    return this;\n  }\n\n  hide() {\n    this.renderService.hide(this);\n  }\n\n  show() {\n    this.renderService.show(this);\n  }\n\n  setZIndex(index) {\n    this.renderService.setZIndex(this, index);\n  }\n\n  setSQL(sql) {\n    this.layerConfig.options.sql = sql;\n    this.hide();\n    return this._getTileUrl().then(this.create.bind(this)).then(this.show.bind(this));\n  }\n\n  _getTileUrl() {\n    return this.apiService.getLayerUrl(this.config);\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./classes/Layer.js","import Karto from './karto.js';\n\n// Download config from server and start the app.\nfetch('config.json').then(res => res.json()).then(initApp);\n\n/**\n * App entry point.\n * Create a karto object and set the app config also expose the karto object to easy debugging.\n */\nfunction initApp(config) {\n\tconst karto = new Karto();\n\tkarto.loadConfig(config);\n\twindow.karto = karto;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./index.js","const HEADERS = new Headers({\n  'Content-Type': 'application/json'\n});\n\n\nexport function getLayerUrl(layer) {\n  return fetch(layer.apiUrl, {\n    method: 'POST',\n    headers: HEADERS,\n    body: _buildBody(layer),\n  })\n    .then(data => data.json())\n    .then(data => `https://ashbu.cartocdn.com/documentation/api/v1/map/${data.layergroupid}/0/{z}/{x}/{y}.png`);\n}\n\n\nfunction _buildBody(layer) {\n  return JSON.stringify({\n    layers: [layer]\n  });\n}\n\n\n\n// WEBPACK FOOTER //\n// ./services/api.service.js","/**\n * Return a MapConfig object from the given config.json file\n */\nexport function parse(config) {\n  return {\n    center: _parseCenter(config.center),\n    zoom: config.zoom,\n    layers: _getLayers(config.layers),\n    apiUrl: _generateUrl(config.maps_api_config),\n  };\n}\n\n/**\n *  The config.json layer type does not match the MapConfig object expected by carto.\n *  this function fixes some fields to create compatibility.\n */\nfunction _getLayers(layers) {\n  return layers.map(layer => {\n    if (layer.type === 'CartoDB') {\n      layer.type = 'cartodb';\n    }\n    if (layer.type === 'tiled') {\n      layer.type = 'http';\n    }\n    return layer;\n  });\n}\n\n// Use the maps_api_config to build an URL. ie: http://documentation.cartodb.com/api/v1/map\nfunction _generateUrl(config) {\n  return config.maps_api_template.replace('{user}', config.user_name) + '/api/v1/map';\n}\n\nfunction _parseCenter(center) {\n  return JSON.parse(center);\n}\n\n\n\n// WEBPACK FOOTER //\n// ./services/config.service.js","var map;\n\nexport function initMap(options, mapId = 'map') {\n  map = L.map(mapId, {\n    center: options.center,\n    zoom: options.zoom\n  });\n}\n\nexport function hide(layer) {\n  layer.view.remove();\n}\n\nexport function show(layer) {\n  layer.view.addTo(map);\n  layer.view.setZIndex(layer.config.zIndex);\n}\n\nexport function create(url) {\n  return L.tileLayer(url);\n}\n\nexport function setZIndex(layer, index) {\n  layer.view.setZIndex(index);\n}\n\n\nexport default {\n  initMap,\n  create,\n  hide,\n  show,\n  setZIndex,\n};\n\n\n\n// WEBPACK FOOTER //\n// ./services/render.service.js"],"sourceRoot":""}