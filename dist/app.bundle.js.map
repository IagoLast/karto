{"version":3,"sources":["webpack:///webpack/bootstrap c084b3680d45b270c7d3","webpack:///./classes/Layer.js","webpack:///./karto.js","webpack:///./classes/CartoLayer.js","webpack:///./classes/LayerFactory.js","webpack:///./index.js","webpack:///./services/api.service.js","webpack:///./services/config.service.js","webpack:///./services/render.service.js"],"names":["Layer","constructor","layerConfig","renderService","apiService","config","init","_getTileUrl","then","create","bind","url","view","hide","show","setZIndex","index","setSQL","sql","options","urlTemplate","Promise","resolve","getLayerUrl","INYECTED_DEPENDENCES","Karto","layers","factory","loadConfig","initMap","center","zoom","addLayers","drawLayers","layersInfo","all","map","addLayer","forEach","layer","$index","zIndex","apiUrl","CartoLayer","_subLayers","subLayers","_isDefined","_createUrl","console","log","subLayer","visible","Error","getGroupLayerUrl","value","undefined","LayerFactory","$injector","type","fetch","res","json","initApp","karto","window","method","headers","HEADERS","body","_buildBody","data","layergroupid","JSON","stringify","_buildNumLayers","length","Headers","indexes","i","push","join","parse","_parseCenter","_getLayers","_generateUrl","maps_api_config","_fixLayerType","_groupLayers","groupLayer","filter","l","maps_api_template","replace","user_name","mapId","L","remove","addTo","tileLayer"],"mappings":"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","file":"app.bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 4);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap c084b3680d45b270c7d3","export default class Layer {\n  /**\n   * The constructor gets the renderService and the apiService injected by the Karto object\n   * This way is easier to mock, test and change implementations.\n   */\n  constructor(layerConfig, {renderService, apiService}) {\n    this.config = layerConfig;\n    this.renderService = renderService;\n    this.apiService = apiService;\n  }\n\n  init() {\n    return this._getTileUrl().then(this.create.bind(this));\n  }\n\n  create(url) {\n    this.url = url;\n    this.view = this.renderService.create(url);\n    return this;\n  }\n\n  hide() {\n    this.renderService.hide(this);\n  }\n\n  show() {\n    this.renderService.show(this);\n  }\n\n  setZIndex(index) {\n    this.renderService.setZIndex(this, index);\n  }\n\n  setSQL(sql) {\n    this.config.options.sql = sql;\n    this.hide();\n    return this._getTileUrl().then(this.create.bind(this)).then(this.show.bind(this));\n  }\n\n  _getTileUrl() {\n    if (this.config.options.urlTemplate) {\n      return Promise.resolve(this.config.options.urlTemplate);\n    }\n    return this.apiService.getLayerUrl(this.config);\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./classes/Layer.js","import LayerFactory from './classes/LayerFactory.js';\nimport * as configService from './services/config.service.js';\nimport * as apiService from './services/api.service.js';\n\n// Choose a renderService between the standard (leaflet) or the google-maps-one.\nimport renderService from './services/render.service.js'; // Render layers using leaflet.\n// import renderService from './services/render.service.google.js'; // Render layers using google maps\n\n// Layer objects will have renderService and apiService injected.\n// This should be done using a proper DI method, but itÂ´s ok for the demo.\nconst INYECTED_DEPENDENCES = {\n  renderService,\n  apiService\n};\n\n/**\n * This is the library main file.\n * This allows to draw a map simply passing a configuraton file.\n * The map is just a list of Layers.\n */\nexport default class Karto {\n  constructor() {\n    this.layers = [];\n    this.factory = new LayerFactory(INYECTED_DEPENDENCES);\n  }\n\n  /**\n   * Create a new map from a json config.\n   * Once the config is correctly parsed and transformed into a `MapConfig` the layers are stored and drawn.\n   */\n  loadConfig(config) {\n    this.config = configService.parse(config);\n    renderService.initMap({\n      center: this.config.center,\n      zoom: this.config.zoom,\n    });\n    this.addLayers(this.config.layers)\n      .then(this.drawLayers);\n  }\n\n  /**\n   * Add a layer list to the Karto map.\n   * The `layers` field is a `MapConfig.layers` object. https://carto.com/docs/carto-engine/maps-api/mapconfig\n   */\n  addLayers(layersInfo) {\n    return Promise.all(layersInfo.map(this.addLayer.bind(this)))\n      .then(layers => {\n        this.layers = layers;\n        return layers;\n      });\n  }\n\n  // Show a list of layers\n  drawLayers(layers) {\n    layers.forEach(layer => layer.show());\n  }\n\n  // Create a new Layer object and add it to the layer list.\n  addLayer(layerConfig, $index) {\n    layerConfig.zIndex = $index;\n    layerConfig.apiUrl = this.config.apiUrl;\n    return this.factory.create(layerConfig).init();\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./karto.js","import Layer from './Layer.js';\n\nexport default class CartoLayer extends Layer {\n  constructor(layerConfig, {renderService, apiService}) {\n    super(layerConfig, {\n      renderService,\n      apiService\n    });\n    this._subLayers = layerConfig.subLayers;\n  }\n\n  hide(index) {\n    this.renderService.hide(this);\n    // Hide the layer with the given index and show the rest\n    if (this._isDefined(index)) {\n      let url = this._createUrl(index, false);\n      this.view = this.renderService.create(url);\n      this.show();\n    }\n  }\n\n\n  show(index) {\n    console.log(this.url);\n    // Add the layer with the given index to the url\n    if (this._isDefined(index)) {\n      let url = this._createUrl(index, true);\n      this.view = this.renderService.create(url);\n    }\n    this.renderService.show(this);\n  }\n\n  setSQL(sql, index) {\n    if (!this._isDefined(index)) {\n      this.config.subLayers.forEach(subLayer => {\n        subLayer.options.sql = sql;\n      });\n    } else {\n      this.config.subLayers[index].options.sql = sql;\n    }\n    this.hide();\n    return this._getTileUrl().then(this.create.bind(this)).then(this.show.bind(this));\n  }\n\n  _createUrl(index, visible) {\n    throw new Error('Not implemented');\n  // let visibleLayers_ = this.url.split(':0')[1].split('{z}')[0];\n  // let visibleLayers = visibleLayers_.replace(index, '');\n  // visibleLayers = visibleLayers.replace(',,', ',');\n  // let url = this.url.replace(visibleLayers_, visibleLayers);\n  }\n\n  _getTileUrl() {\n    return this.apiService.getGroupLayerUrl(this.config);\n  }\n\n  _isDefined(value) {\n    return value !== undefined && value !== null;\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./classes/CartoLayer.js","import Layer from './Layer.js';\nimport CartoLayer from './CartoLayer.js';\n\nexport default class LayerFactory {\n  constructor($injector) {\n    this.$injector = $injector;\n  }\n\n  create(layerConfig) {\n    if (layerConfig.type === 'group') {\n      return new CartoLayer(layerConfig, this.$injector);\n    }\n    return new Layer(layerConfig, this.$injector);\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./classes/LayerFactory.js","import Karto from './karto.js';\n\n// Download config from server and start the app.\nfetch('config.json').then(res => res.json()).then(initApp);\n\n/**\n * App entry point.\n * Create a karto object and set the app config also expose the karto object to easy debugging.\n */\nfunction initApp(config) {\n\tconst karto = new Karto();\n\tkarto.loadConfig(config);\n\twindow.karto = karto;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./index.js","// Get the tile server url from a given layer configuration\nexport function getLayerUrl(layer) {\n  return fetch(layer.apiUrl, {\n    method: 'POST',\n    headers: HEADERS,\n    body: _buildBody(layer),\n  })\n    .then(data => data.json())\n    .then(data => `https://ashbu.cartocdn.com/documentation/api/v1/map/${data.layergroupid}/0/{z}/{x}/{y}.png`);\n}\n\nexport function getGroupLayerUrl(layers) {\n  return fetch(layers.apiUrl, {\n    method: 'POST',\n    headers: HEADERS,\n    body: JSON.stringify(\n      {\n        layers: layers.subLayers\n      }\n    ),\n  })\n    .then(data => data.json())\n    .then(data => `https://ashbu.cartocdn.com/documentation/api/v1/map/${data.layergroupid}/${_buildNumLayers(layers.subLayers.length)}/{z}/{x}/{y}.png`);\n}\n\nconst HEADERS = new Headers({\n  'Content-Type': 'application/json'\n});\n\nfunction _buildBody(layer) {\n  return JSON.stringify({\n    layers: [layer]\n  });\n}\n\n// Return a formated layer index froma given length.\n\nfunction _buildNumLayers(length) {\n  let indexes = [];\n  for (let i = 0; i < length; i++) {\n    indexes.push(i);\n  }\n  return indexes.join(',');\n}\n\n\n\n// WEBPACK FOOTER //\n// ./services/api.service.js","/**\n * Return a MapConfig object from the given config.json file\n */\nexport function parse(config) {\n  return {\n    center: _parseCenter(config.center),\n    zoom: config.zoom,\n    layers: _getLayers(config.layers),\n    apiUrl: _generateUrl(config.maps_api_config),\n  };\n}\n\n/**\n *  The config.json layer type does not match the MapConfig object expected by carto.\n *  this function fixes some fields to create compatibility.\n */\nfunction _getLayers(layers) {\n  layers = layers.map(_fixLayerType);\n  return _groupLayers(layers);\n}\n\n// Group all cartodb layers into a single one.\nfunction _groupLayers(layers) {\n  let groupLayer = {\n    type: 'group',\n    subLayers: layers.filter(layer => layer.type === 'cartodb')\n  };\n  let l = layers.filter(layer => layer.type !== 'cartodb');\n  l.push(groupLayer);\n  return l;\n}\n\n// Some values in the layer.type doesnt match the expected by the Mapconfig.\nfunction _fixLayerType(layer) {\n  if (layer.type === 'CartoDB') {\n    layer.type = 'cartodb';\n  }\n  if (layer.type === 'tiled') {\n    layer.type = 'http';\n  }\n  return layer;\n}\n\n// Use the maps_api_config to build an URL. ie: http://documentation.cartodb.com/api/v1/map\nfunction _generateUrl(config) {\n  return config.maps_api_template.replace('{user}', config.user_name) + '/api/v1/map';\n}\n\nfunction _parseCenter(center) {\n  return JSON.parse(center);\n}\n\n\n\n// WEBPACK FOOTER //\n// ./services/config.service.js","var map;\n\nexport function initMap(options, mapId = 'map') {\n  map = L.map(mapId, {\n    center: options.center,\n    zoom: options.zoom\n  });\n}\n\nexport function hide(layer) {\n  layer.view.remove();\n}\n\nexport function show(layer) {\n  layer.view.addTo(map);\n  layer.view.setZIndex(layer.config.zIndex);\n}\n\nexport function create(url) {\n  return L.tileLayer(url);\n}\n\nexport function setZIndex(layer, index) {\n  layer.view.setZIndex(index);\n}\n\n\nexport default {\n  initMap,\n  create,\n  hide,\n  show,\n  setZIndex,\n};\n\n\n\n// WEBPACK FOOTER //\n// ./services/render.service.js"],"sourceRoot":""}