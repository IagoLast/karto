{"version":3,"sources":["webpack:///webpack/bootstrap 7603356324ea69b41d35","webpack:///./karto.js","webpack:///./classes/CartoLayer.js","webpack:///./classes/Layer.js","webpack:///./classes/LayerFactory.js","webpack:///./classes/LayerGroup.js","webpack:///./index.js","webpack:///./services/api.service.js","webpack:///./services/config.service.js","webpack:///./services/render.service.js"],"names":["INYECTED_DEPENDENCES","renderService","apiService","Karto","constructor","layers","layerGroup","factory","loadConfig","config","initMap","apiUrl","createLayers","initLayers","then","showLayers","layersInfo","map","createLayer","bind","layerInfo","index","zIndex","create","Promise","all","layer","init","forEach","show","CartoLayer","layerConfig","type","options","visible","addLayer","hide","hideLayer","showLayer","setSQL","sql","updateUrl","reload","toJSON","Layer","_getTileUrl","url","view","urlTemplate","resolve","getLayerUrl","LayerFactory","$injector","LayerGroup","initialized","push","_updateVisibility","visibleLayers","replace","join","getGroupLayerUrl","fetch","res","json","initApp","karto","window","method","headers","HEADERS","body","_buildBody","data","layergroupid","Headers","JSON","stringify","parse","center","_parseCenter","zoom","_getLayers","_generateUrl","maps_api_config","_fixLayerType","_groupLayers","groupLayer","subLayers","filter","l","maps_api_template","user_name","mapId","L","remove","addTo","tileLayer"],"mappings":"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","file":"app.bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 5);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 7603356324ea69b41d35","import LayerFactory from './classes/LayerFactory.js';\nimport * as configService from './services/config.service.js';\nimport * as apiService from './services/api.service.js';\nimport LayerGroup from './classes/LayerGroup.js';\n\n// Choose a renderService between the standard (leaflet) or the google-maps-one.\nimport renderService from './services/render.service.js'; // Render layers using leaflet.\n// import renderService from './services/render.service.google.js'; // Render layers using google maps\n\n// Layer objects will have renderService and apiService injected.\n// This should be done using a proper DI method, but it´s ok for the demo.\nconst INYECTED_DEPENDENCES = {\n  renderService,\n  apiService\n};\n\n/**\n * This is the library main file.\n * This allows to draw a map simply passing a configuraton file.\n * The map is just a list of Layers.\n */\nexport default class Karto {\n  constructor() {\n    this.layers = [];\n    this.layerGroup = new LayerGroup(INYECTED_DEPENDENCES);\n    this.factory = new LayerFactory(INYECTED_DEPENDENCES, this.layerGroup);\n  }\n\n  /**\n   * Create a new map from a json config.\n   * Once the config is correctly parsed and transformed into a `MapConfig` the layers are stored and drawn.\n   */\n  loadConfig(config) {\n    this.config = configService.parse(config);\n    renderService.initMap(this.config);\n    this.layerGroup.apiUrl = this.config.apiUrl;\n    this.layers = this.createLayers(this.config.layers);\n    this.initLayers(this.layers).then(this.showLayers);\n  }\n\n  // Create a list of layers\n  createLayers(layersInfo) {\n    return layersInfo.map(this.createLayer.bind(this));\n  }\n\n  createLayer(layerInfo, index) {\n    layerInfo.zIndex = index;\n    layerInfo.apiUrl = this.config.apiUrl;\n    return this.factory.create(layerInfo);\n  }\n\n  initLayers(layers) {\n    return Promise.all(layers.map(layer => layer.init()));\n  }\n\n  // Show a list of layers\n  showLayers(layers) {\n    layers.forEach(layer => layer.show());\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./karto.js","export default class CartoLayer {\n\n  constructor(layerConfig, layerGroup) {\n    this.zIndex = layerConfig.zIndex;\n    this.type = layerConfig.type;\n    this.options = layerConfig.options;\n    this.layerGroup = layerGroup;\n    this.visible = false;\n    layerGroup.addLayer(this);\n  }\n\n  init() {\n    return this.layerGroup.init().then(() => {\n      return this;\n    });\n  }\n\n  hide() {\n    this.visible = false;\n    this.layerGroup.hideLayer(this);\n  }\n\n  show() {\n    this.visible = true;\n    this.layerGroup.showLayer(this);\n  }\n\n  setSQL(sql) {\n    this.options.sql = sql;\n    this.layerGroup.updateUrl().then(() => this.layerGroup.reload());\n  }\n\n  // Prevent circular JSON error when sending data to the server.\n  toJSON() {\n    return {\n      options: this.options,\n      type: this.type,\n    };\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./classes/CartoLayer.js","export default class Layer {\n  /**\n   * The constructor gets the renderService and the apiService injected by the Karto object\n   * This way is easier to mock, test and change implementations.\n   */\n  constructor(layerConfig, {renderService, apiService}) {\n    this.zIndex = layerConfig.zIndex;\n    this.config = layerConfig;\n    this.renderService = renderService;\n    this.apiService = apiService;\n    this.visible = false;\n  }\n\n  // Get the tile server url\n  init() {\n    return this._getTileUrl().then(this.create.bind(this));\n  }\n\n  // Create a view for this model\n  create(url) {\n    this.url = url;\n    this.view = this.renderService.create(url);\n    return this;\n  }\n\n  hide() {\n    this.visible = false;\n    this.renderService.hide(this);\n  }\n\n  show() {\n    this.visible = true;\n    this.renderService.show(this);\n  }\n\n  _getTileUrl() {\n    if (this.config.options.urlTemplate) {\n      return Promise.resolve(this.config.options.urlTemplate);\n    }\n    return this.apiService.getLayerUrl(this.config);\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./classes/Layer.js","import Layer from './Layer.js';\nimport CartoLayer from './CartoLayer.js';\n\nexport default class LayerFactory {\n  constructor($injector, layerGroup) {\n    this.$injector = $injector;\n    this.layerGroup = layerGroup;\n  }\n\n  create(layerConfig) {\n    if (layerConfig.type === 'cartodb') {\n      return new CartoLayer(layerConfig, this.layerGroup);\n    }\n    return new Layer(layerConfig, this.$injector);\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./classes/LayerFactory.js","export default class LayerGroup {\n  constructor({renderService, apiService}) {\n    this.layers = [];\n    this.renderService = renderService;\n    this.apiService = apiService;\n    this.config = {};\n    return this;\n  }\n\n  init() {\n    if (!this.initialized) {\n      this.initialized = true;\n      return this._getTileUrl().then(() => this);\n    }\n    return Promise.resolve(this);\n  }\n\n  addLayer(layer) {\n    this.config.zIndex = layer.zIndex;\n    this.layers.push(layer);\n  }\n\n  hideLayer() {\n    this.reload();\n  }\n\n  showLayer() {\n    this.reload();\n  }\n\n  reload() {\n    if (this.view) {\n      this.renderService.hide(this);\n    }\n    this._updateVisibility();\n    this.view = this.renderService.create(this.url);\n    this.renderService.show(this);\n  }\n\n  // Called when some layer has changed its config\n  updateUrl() {\n    return this._getTileUrl();\n  }\n\n  _updateVisibility() {\n    let visibleLayers = [];\n    this.layers.forEach((layer, index) => {\n      if (layer.visible) {\n        visibleLayers.push(index);\n      }\n    });\n    this.url = this.urlTemplate.replace('{{layers}}', visibleLayers.join(','));\n  }\n\n  _getTileUrl() {\n    return this.apiService.getGroupLayerUrl(this.layers, this.apiUrl).then(urlTemplate => {\n      this.urlTemplate = urlTemplate;\n    });\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./classes/LayerGroup.js","import Karto from './karto.js';\n\n// Download config from server and start the app.\nfetch('config.json').then(res => res.json()).then(initApp);\n\n/**\n * App entry point.\n * Create a karto object and set the app config also expose the karto object to easy debugging.\n */\nfunction initApp(config) {\n\tconst karto = new Karto();\n\tkarto.loadConfig(config);\n\twindow.karto = karto;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./index.js","// Get the tile server url from a given layer configuration\nexport function getLayerUrl(layer) {\n  return fetch(layer.apiUrl, {\n    method: 'POST',\n    headers: HEADERS,\n    body: _buildBody([layer]),\n  })\n    .then(data => data.json())\n    .then(data => `https://ashbu.cartocdn.com/documentation/api/v1/map/${data.layergroupid}/0/{z}/{x}/{y}.png`);\n}\n\nexport function getGroupLayerUrl(layers, apiUrl) {\n  return fetch(apiUrl, {\n    method: 'POST',\n    headers: HEADERS,\n    body: _buildBody(layers),\n  })\n    .then(data => data.json())\n    .then(data => `https://ashbu.cartocdn.com/documentation/api/v1/map/${data.layergroupid}/{{layers}}/{z}/{x}/{y}.png`);\n}\n\nconst HEADERS = new Headers({\n  'Content-Type': 'application/json'\n});\n\nfunction _buildBody(layers) {\n  return JSON.stringify({\n    layers\n  });\n}\n\n\n\n// WEBPACK FOOTER //\n// ./services/api.service.js","/**\n * Return a MapConfig object from the given config.json file\n */\nexport function parse(config) {\n  return {\n    center: _parseCenter(config.center),\n    zoom: config.zoom,\n    layers: _getLayers(config.layers),\n    apiUrl: _generateUrl(config.maps_api_config),\n  };\n}\n\n/**\n *  The config.json layer type does not match the MapConfig object expected by carto.\n *  this function fixes some fields to create compatibility.\n */\nfunction _getLayers(layers) {\n  return layers.map(_fixLayerType);\n}\n\n// Group all cartodb layers into a single one.\nfunction _groupLayers(layers) {\n  let groupLayer = {\n    type: 'group',\n    subLayers: layers.filter(layer => layer.type === 'cartodb')\n  };\n  let l = layers.filter(layer => layer.type !== 'cartodb');\n  l.push(groupLayer);\n  return l;\n}\n\n// Some values in the layer.type doesnt match the expected by the Mapconfig.\nfunction _fixLayerType(layer) {\n  if (layer.type === 'CartoDB') {\n    layer.type = 'cartodb';\n  }\n  if (layer.type === 'tiled') {\n    layer.type = 'http';\n  }\n  return layer;\n}\n\n// Use the maps_api_config to build an URL. ie: http://documentation.cartodb.com/api/v1/map\nfunction _generateUrl(config) {\n  return config.maps_api_template.replace('{user}', config.user_name) + '/api/v1/map';\n}\n\nfunction _parseCenter(center) {\n  return JSON.parse(center);\n}\n\n\n\n// WEBPACK FOOTER //\n// ./services/config.service.js","var map;\n\nexport function initMap(options, mapId = 'map') {\n  map = L.map(mapId, {\n    center: options.center,\n    zoom: options.zoom\n  });\n}\n\nexport function hide(layer) {\n  layer.view.remove();\n}\n\nexport function show(layer) {\n  layer.view.addTo(map);\n}\n\nexport function create(url) {\n  return L.tileLayer(url);\n}\n\n\nexport default {\n  initMap,\n  create,\n  hide,\n  show,\n};\n\n\n\n// WEBPACK FOOTER //\n// ./services/render.service.js"],"sourceRoot":""}